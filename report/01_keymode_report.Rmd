---
title: "Song Key Mode & Popularity"
author: "Socorro Dominguez and Paul Vial"
date: '2018-11-16'
output: pdf_document
header-includes: \usepackage{float}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

Is the popularity of songs in a major key different than songs in a minor key? (Are they more likely to be in the Top 100?) This is the question we will try to answer by looking at and analyzing Spotify's Top 100 streamed songs! 

First of all, in music, "keys" are sets of notes which sound harmonious together. One of the most distinguishing features of a musical key is its "mode" which we can categorize as "major" or "minor." These two modes affect the mood of music similarly to how certain beats may make songs more "likable." Music written in a major key-mode usually sounds happy, while music written in a minor key-mode usually sounds sad or serious. 

It may seem intuitive that, because they sound "happier," songs in a major key would be more popular, the assumption being that people are more attracted to happy sounding songs than songs that sound sad or serious.  However, the prevalence of songs written in a minor key-mode appears to contradict this assumption, and so we are interested in whether these modes (major vs. minor) of songs' keys actually affect their popularity.  We hope that answering this question will help us understand the extent to which key-mode is a factor that makes certain songs more widely appealing to than others to listeners.

Spotify is a music streaming platform. They have become an important platform as they currently have 191 million users. 87 million of these users, pay in order to be premium users. Their Top 100 is defined by the songs that are streamed the most throught a year. 

Through this evaluation, we go through Spotify's Top 100 2017 data set to analyze whether people are actively listening to more songs that are in major key-modes or minor key-modes. 

Once we load the data, we make a small summary to see actually how many songs in Spotify have a minor or a major mode. <br>

Table 1: Summary of how many songs have a major or minor mode:

| Mode | Avg Rank | Count | Diff. Est. |
|---|---|---|---|
|Minor | 48.78 | 42 | 2.9556 |
|Major | 51.74  | 58 | 2.9556 | 

We can read from the following graph, that at least for the 2017's Top 100, songs in a major key-mode (or happier sound) were more popular than songs in a minor key-mode (or sad/serious sound). However, this might just be by chance. 

```{r, out.width = '80%', fig.cap='Number of top 100 songs written in each key-mode', fig.pos = 'H'}
knitr::include_graphics("../results/figure/Fig01_Mode_Viz.png")
```
The next plot shows distribution of key-modes throughout the song rankings that we used.  From this visualization we can see that there does not appear to be any significant clustering of one of the key modes near a particular range of the song rankings which might affect our analysis.

```{r, out.width = '100%', fig.cap='Distribution of key-mode over song ranks', fig.pos = 'H'}
knitr::include_graphics("../results/figure/Fig05_Mode_Over_Rank_Plot.png")
```

Out of curiosity, let's also evaluate how other features (danceability, key, loudness, etc) in the song vary with by songs' key-modes:

```{r, out.width = '80%', fig.cap='How does mode interact with the other features?', fig.pos = 'H'}
knitr::include_graphics("../results/figure/Fig02_Explore_Mode_and_Features.png")
```

We understand, that by just working with this key-mode (rather than the combination of features) is a limitation of our work. And if given more time, we would love to explore all the features to see what makes a song really popular. 

Now, using 'Estimation through simulation,' we are going to test if the key-mode actually plays a role in the songs' rankings.

Our hypotheses are as follows:

  \textbf{$H_{0}$}: Songs in a major key-mode have an equal average Spotify ranking to songs in a minor key-mode.

  \textbf{$H_{A}$}: Songs in a major key-mode have different average Spotify ranking than songs in a minor key-mode.

Our test statistic is the difference between songs in a major key-mode and songs in a minor key-mode.

```{r, out.width = '80%', fig.cap='Error bars represent 95\\% confidence intervals generated by bootstrapping', fig.pos = 'H'}
knitr::include_graphics("../results/figure/Fig04_Sample_Compare_Plot.png")
```


In the Figure 4 above, we can see that there is significant overlap between the confidence intervals for the two groups.

Figure 5 below, illustrates where our p-value falls relative to the confidence interval for our test statistic:

```{r, out.width = '80%', fig.cap="Null distribution of rank by key-mode.  Error bars represent 90\\% confidence intervals generated by TBD permutation", fig.pos = 'H'}
knitr::include_graphics("../results/figure/Fig03_Test_Ddistr_Plot.png")
```

# RESULTS: 

- Our p-value is \textbf{$0.622$}.  As our p-value is larger than the alpha (\textbf{$0.1$}), we do not reject the null hypothesis. 

Our dataset is the top 100 songs which creates a sampling bias.  Ideally, we would be able to compare the proportions of songs in each key-mode from the top 100 to the proportions of songs in each key-mode from a random sample of Spotify songs.

This analysis is very limited due to time constraints, and we are only taking into consideration one feature of the songs. We would like to analyze all the features and their combinations to see how this affects a song's popularity. 

Given more time in the future, we would like to try a more in-depth analysis and maybe try using a Decision Tree to consider all other song features besides key-mode. 

## OUR CONCLUSION:
After having evaluated this dataset, and done the statistical analysis, we are sad to discover that there is not enough evidence to reject our Null Hypothesis. That is to say, we are not sure if the mode does make a song more likable or not. 

We would like to look at what role the other features play and how important interaction between these features is. 

## REFERENCES

Top Spotify Tracks of 2017, Audio features of top Spotify songs - Retrieved from: https://www.kaggle.com/nadintamer/top-tracks-of-2017

Wikipedia Major and Minor - Retrieved from: https://en.wikipedia.org/wiki/Major_and_minor

UBC MDS Statistical Inference Lecture 04 - Retrieved from: https://github.ubc.ca/MDS-2018-19/DSCI_552_stat-inf-1_students/blob/master/lectures/04_lecture-sim-estimation-wrap-up-and-hyp-test-intro.ipynb

Wikipedia Spotify - Retriefed from: https://en.wikipedia.org/wiki/Spotify